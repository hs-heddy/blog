20170824-Security-JAWS.md
-----

### 概要

* https://s-jaws.doorkeeper.jp/events/63540
* Security-JAWS 【第6回】2017年8月24日(木)
* 2017年8月24日（木）　19:00～21:30（開場18:30/前説18:50）

* TW: https://twitter.com/security_jaws
* ハッシュタグは#secjaws #secjaws06

−−−−−

### Session1:クラスメソッド株式会社 佐々木 大輔さん「ざっくりわかるAmazon Macie」
* Amazon Macie は、機械学習によって AWS 内の機密データを自動的に検出、分類、保護するセキュリティサービス(AWS公式サイトより)
* S3に置かれた(もしくはこれから追加する)ファイルのコンテンツ解析とCloudTrailイベントの解析ができる

#### 自分のGithubをS3に上げてMacieにかけてみた
* アプリケーションタイプは大半がPython残りはJSONなど
* 個人情報を調べてみたら、43件のLow警告と1件のHigh警告が出た。 このHigh1件は誕生日が入っていた。

#### CloudTrailのログに実行
* ログインしたアカウント一覧が見える。 rootからログインしているのが見えた。
* ログイン元のIPアドレスを見る。 上位は自分のアクセスだが、下位の方に不明なアクセス元があった。

#### 価格
* S3コンテンツ解析は最初の1Gは無料、以降1GByteにつき5$

#### まとめ
* リスク解析の観点から全ユーザに利用を推奨する

#### QA
* 現状Macieはオレゴンかバージニアでしか動かないけど、監視先S3バケットの置き場は東京含め全リージョンOK(ただし英語に最適化されている)

-----

* (予告タイムテーブルとSession2,3を入れ替えました)

### Session2:NRIセキュアテクノロジーズ株式会社 大島 修さん「AWSで実践するリスト型アカウントハッキング対策（仮）」

* アカウントハッキング被害事例→ 犯人の動機の多くは金銭
* 攻撃方法としてリスト型攻撃が準備と成功率からメジャーになりつつある
* リストの入手は脆弱性のあるサイトと使えば容易

#### アカウントハッキングは多層で防御
* WAFでブルートフォースアタックを防ぐ
* 不正防止ツールでリスト型攻撃や地理特性やなりすましを防ぐ
* 多要素認証を使うとなお良い

#### AWS WAFで防御
* AWS WAFでレートリミット設定→5分で2000アクセスが下限なのでボットネットを使い分散されて攻撃受けると辛い
* AWS WAF+Lambdaによる高頻度アクセスIPのブロック(サンプルがAWSサイトにある)

#### 不正検知ツールによる防御
* 端末フィンガープリント：普段使ってない端末を警戒
* ページ遷移特性：突然取引のページを見るなど通常のページ遷移でない物を警戒
* 地理特性：攻撃の多い国からのアクセス、普通の移動(速度等)ではあり得ない場所からのアクセスを警戒
* サービス利用特性：普段の取引と量や金額が違う場合に警戒
* 警戒する場合のみ多要素認証にすることで、多要素認証のユーザビリティの低下を防ぐ

#### まとめ
* 「AWS WAFでレートリミット設定」は簡単なのですぐに設定すること
* 高頻度アクセスブロックも入れよう
* 金銭やポイントを扱うサイトでは不正検知ツールによる防御を検討しよう

-----

### Session3:F5ネットワークスジャパン株式会社 牧田 延大さん「BIG-IPをVPCエンドポイント的に使ってみた 〜F5のAWS関連アップデートもあるよ（仮）」

#### 外部からS3へ繋ぐには？
* 2015年まで：IGWとNATを利用
* 2015年春VPCエンドポイント登場
* 2017年：BIG-IP使って何か出来そう

#### BIG-IPで出来ること
* BIG-IPをAWS S3のプロキシとして使う
* IAMで一時URLを発行して万一攻撃を受けたときに被害の拡大を防ぐ

#### さらにBIG-IPで出来ること
* コンテンツキャッシュ
* WAFもできる

#### お約束の機能○×表
* (▲価格ちょっと高い)セキュリティは価格ではないよね？

-----

### Session4:アマゾン ウェブ サービス ジャパン株式会社 酒徳 知明さん「DevSecOps in AWS Multi-Account」

* (会場に質問)「みなさんシングルアカウントですか、マルチアカウントですか？」→シングルは2,3人で残りはマルチ、「全てのマルチアカウントの設定は完璧ですか？」→誰も手を上げず
* マルチアカウントの前に…IAMの設定をしっかりやる

#### マルチアカウントのベストプラクティス
* まずアカウントAで全ユーザを管理する
* アカウントB,C,D…にはIAM Roleを使い一時的なトークンを発行するRoleを作る(例：EC2制作用Roleなど)
* 親のアカウントでCloudFormationを設定し、子のアカウントに全て同じ設定が配布されるようにする
* このCloudFormationの中身は「一時トークン発行用Roleを作る、CloudTrailをオンにし重要なイベントを親のアカウントへ通知する、S3バケットのバージョン管理とログの採取を行う」など

#### CloudFormation実演
* 最近、GUIだけで基本的な設定の配布が出来るようになった

#### 今回使ったアンケートツール
* Mentimeter
* https://www.menti.com
* menti.com ＋ 6桁のアンケートコードだけでリアルタイムアンケートが出来る
* 無料でも2件のアンケートが出来るのでトークの前にやると楽しい

-----

### Session5:株式会社ラック 関 宏介さん「AWS環境におけるフォレンジック(仮)」

#### フォレンジック事例
* 古いバージョンをソースから入れた→パスワードがデフォルトかつroot権限で動いていた
* root権限により被害が拡大した
* 検証用に社内環境と同じバージョンをAWS EC2に作っていた

#### フォレンジック技術を使う利点
* rootkit等OSが信頼できない時でもデータを取得出来る

#### AWSのイメージコピー
* ddコマンドを使う

#### AWSでのフォレンジック手法
* やられたボリュームのスナップコピーをとって
* 新しいボリュームを作りスナップコピーの復旧
* 調査用インスタンスへアタッチ

#### SSHを使ったイメージコピー
* ssh -C user@host "sudo dd bs=512 conv=noerroe,sync〜
* CPU利用率は高いがデータ転送は意外と早い

#### まとめ
* 検証用でもアクセス制御不備に注意
* やられたらすぐにスナップショットをとる
